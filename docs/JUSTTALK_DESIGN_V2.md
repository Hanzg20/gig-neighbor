# JustTalk（真言）产品设计文档 v2.0

**版本**: v2.0
**日期**: 2026-01-19
**状态**: 设计定稿

---

## 一、产品体系

### 1.1 双产品架构

```
┌─────────────────────────────────────────────────────────────┐
│                    JUSTWEDO 产品生态                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────────┐         ┌─────────────────┐          │
│   │  渥帮 JUSTWEDO  │ ←─────→ │  真言 JustTalk  │          │
│   │   (交易平台)     │  信任   │   (社区信任层)   │          │
│   │                 │  闭环   │                 │          │
│   │  • 服务发布预订  │         │  • 普通帖+真言帖 │          │
│   │  • 租赁/商品市场 │         │  • 社区共识投票  │          │
│   │  • 任务接单     │         │  • 用户贡献等级  │          │
│   │  • 支付结算     │         │  • 供应商孵化    │          │
│   └─────────────────┘         └─────────────────┘          │
│                                                             │
│   核心使命: 用"真言"机制构建真实社区，                        │
│            让用户更安全、更放心地找人/找服务                   │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 目标用户

- 渥太华及加拿大城市居民（华人 + 本地人）
- 租客、学生、新移民、带娃家庭
- 本地小商家、自由职业者、邻里帮手

---

## 二、JustTalk 内容分类体系

### 2.1 帖子分类（postType）

所有分类都支持**普通模式**和**真言模式**两种发布方式。

| 分类ID | 中文名 | 英文名 | 图标 | 说明 | 适用真言场景 |
|--------|-------|--------|------|------|-------------|
| `MOMENT` | 邻里 | Neighbors | 🏘️ | 日常分享、生活瞬间 | 邻居互动经历、小区见闻 |
| `ACTION` | 参加 | Events | 🤝 | 活动召集、组队参与 | 活动体验、组织者评价 |
| `HELP` | 求助 | Help | 🆘 | 求助需求、寻人寻物 | 求助结果、帮助者评价 |
| `NOTICE` | 公告 | Notices | 📢 | 社区通知、重要信息 | 物业问题、安全警报 |

### 2.2 发布模式（isFact）

每个帖子都有一个 `isFact` 开关：

| 模式 | 标识 | 说明 | 字段要求 |
|------|------|------|---------|
| **普通模式** | 无特殊标识 | 日常分享、闲聊、讨论 | 内容、图片（可选） |
| **真言模式** | ✅ FACT | 亲身经历的事实陈述 | 内容 + 时间 + 地点 + 类型 + 证据（可选） |

---

## 三、真言模式设计

### 3.1 真言的定义

> **真言 = 写你亲身经历的事实，邻居通过"是否与经历一致"来帮你校验**

**核心原则**：
- 陈述事实，不是评价（"等了1小时" vs "服务差"）
- 结构化描述，便于验证
- 社区共识，而非官方认证

### 3.2 真言额外字段

```typescript
interface FactData {
  // 必填
  occurredAt: string;        // 发生时间（日期或大致月份）
  location: string;          // 发生地点（自动带小区，可手填）
  factType: FactType;        // 事件类型

  // 可选
  subject?: {                // 涉及对象
    type: 'business' | 'service' | 'person' | 'property';
    name: string;
    identifier?: string;     // 关联的商家/服务ID
  };
  evidence?: string[];       // 证据图片（最多3张）
}

type FactType =
  | 'SERVICE_EXPERIENCE'     // 服务体验
  | 'PROPERTY_ISSUE'         // 物业问题
  | 'PRICE_CHANGE'           // 价格变动
  | 'SAFETY_ALERT'           // 安全提醒
  | 'RECOMMENDATION'         // 真心推荐
  | 'OTHER';                 // 其他
```

### 3.3 真言发帖引导文案

```
┌────────────────────────────────────────────────────┐
│  发布模式                                          │
│                                                    │
│  ○ 普通帖 - 随便聊聊                               │
│  ● 真言帖 - 分享真实经历，让邻居帮你验证 ✅         │
│                                                    │
│  ────────────────────────────────────────────────  │
│                                                    │
│  💡 真言 = 写你亲身经历的事                         │
│     邻居会投票"与我经历是否一致"来帮你校验          │
│                                                    │
└────────────────────────────────────────────────────┘
```

---

## 四、社区共识机制

### 4.1 投票选项

位置：真言帖正文下方、评论上方

| 选项 | 说明 | 用户心理 |
|------|------|---------|
| 与我的经历一致 | "我也遇到过同样的事" | 验证+背书 |
| 部分一致 | "类似但有出入" | 补充视角 |
| 与我的经历不一致 | "我的经历完全不同" | 反面验证 |
| 不确定/没经历过 | "我没法判断" | 保持中立 |

### 4.2 共识条展示

```
┌────────────────────────────────────────────────────┐
│  社区共识                                          │
│                                                    │
│  ████████████░░░░░░░░  68% 一致                   │
│  ▓▓▓▓▓░░░░░░░░░░░░░░░  20% 部分一致              │
│  ▒▒░░░░░░░░░░░░░░░░░░   8% 不一致                │
│  ░░░░░░░░░░░░░░░░░░░░   4% 不确定                │
│                                                    │
│  共 25 位邻居参与验证                              │
│                                                    │
│  [与我经历一致] [部分一致] [不一致] [不确定]        │
└────────────────────────────────────────────────────┘
```

### 4.3 共识等级

```typescript
type ConsensusLevel =
  | 'HIGH'          // agree >= 70%, votes >= 10
  | 'MEDIUM'        // agree >= 50%, votes >= 5
  | 'LOW'           // agree < 50% || votes < 5
  | 'CONTROVERSIAL' // disagree >= 30%
  | 'PENDING';      // votes < 3

// 展示提示
const levelHints = {
  HIGH: "高度一致，可信度较高",
  MEDIUM: "多数一致，可参考",
  LOW: "样本较少，谨慎参考",
  CONTROVERSIAL: "存在争议，建议多方了解",
  PENDING: "等待更多邻居验证"
};
```

---

## 五、UI 设计规范

### 5.1 卡片样式对比

#### 普通帖卡片
```
┌────────────────────────────────────────┐
│  🏘️ 邻里                               │  ← 分类标签
├────────────────────────────────────────┤
│  ┌────────────────────────────────┐   │
│  │                                │   │
│  │           封面图               │   │
│  │                                │   │
│  └────────────────────────────────┘   │
│                                        │
│  今天在小区遛狗认识了新邻居...          │  ← 内容
│                                        │
│  👤 用户名          ❤️ 23  💬 5       │  ← 底部栏
└────────────────────────────────────────┘
```

#### 真言帖卡片
```
┌────────────────────────────────────────┐
│  ✅ 真言 · 🏘️ 邻里 · 服务体验          │  ← 真言标识 + 分类 + 类型
├────────────────────────────────────────┤
│  ┌────────────────────────────────┐   │
│  │                                │   │
│  │           封面图/证据图         │   │
│  │                                │   │
│  └────────────────────────────────┘   │
│                                        │
│  昨天在XX餐厅吃饭，等了1小时才上菜...   │  ← 内容
│                                        │
│  📍 XX餐厅 · Bank Street              │  ← 地点
│  📅 2026-01-18                        │  ← 时间
│                                        │
│  ┌────────────────────────────────┐   │
│  │ ████████████░░░░  68% 一致     │   │  ← 共识条
│  │ 12人验证 · 高度一致             │   │
│  └────────────────────────────────┘   │
│                                        │
│  👤 用户名 Lv.3      ❤️ 23  💬 5     │  ← 底部栏（含用户等级）
└────────────────────────────────────────┘
```

### 5.2 颜色系统

```css
/* 真言标识 */
--fact-badge-bg: #10B981;        /* 绿色背景 */
--fact-badge-text: #FFFFFF;

/* 共识条颜色 */
--consensus-agree: #22C55E;      /* 一致 - 绿色 */
--consensus-partial: #F59E0B;    /* 部分一致 - 橙色 */
--consensus-disagree: #EF4444;   /* 不一致 - 红色 */
--consensus-uncertain: #6B7280;  /* 不确定 - 灰色 */

/* 用户等级颜色 */
--level-1: #94A3B8;              /* 新邻居 */
--level-2: #22C55E;              /* 活跃邻居 */
--level-3: #3B82F6;              /* 热心邻居 */
--level-4: #8B5CF6;              /* 社区达人 */
--level-5: #F59E0B;              /* 真言先锋 */
```

---

## 六、用户贡献度与等级系统

### 6.1 贡献度计算

```typescript
interface UserContribution {
  // 基础贡献
  totalPosts: number;           // 总发帖数
  totalComments: number;        // 总评论数
  totalLikesReceived: number;   // 获得的点赞数

  // 真言贡献（权重更高）
  factPosts: number;            // 真言帖数量
  factVotesReceived: number;    // 真言获得的投票数
  factAgreeRate: number;        // 真言平均认可率

  // 参与贡献
  votesGiven: number;           // 参与投票次数
  helpfulComments: number;      // 有帮助的评论数
}

// 贡献度分数计算
function calculateContributionScore(c: UserContribution): number {
  return (
    c.totalPosts * 5 +
    c.totalComments * 2 +
    c.totalLikesReceived * 1 +
    c.factPosts * 20 +                    // 真言帖权重高
    c.factVotesReceived * 3 +
    c.factAgreeRate * 50 +                // 高认可率加成
    c.votesGiven * 1 +
    c.helpfulComments * 5
  );
}
```

### 6.2 用户等级体系

| 等级 | 名称 | 图标 | 贡献度要求 | 权益 |
|------|------|------|-----------|------|
| Lv.1 | 新邻居 | 🌱 | 0 | 基础功能 |
| Lv.2 | 活跃邻居 | 🌿 | 100 | 投票权重+10% |
| Lv.3 | 热心邻居 | 🌳 | 500 | 评论置顶权限 |
| Lv.4 | 社区达人 | ⭐ | 2000 | 真言优先展示 |
| Lv.5 | 真言先锋 | 👑 | 5000 | 供应商快速通道 |

### 6.3 等级显示

```
┌─────────────────────────────────────┐
│  👤 张三                            │
│  Lv.4 ⭐ 社区达人                   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ ████████████████░░░░  2847   │   │  ← 贡献度进度条
│  │ 距离 Lv.5 还需 2153 贡献度    │   │
│  └─────────────────────────────┘   │
│                                     │
│  📝 发帖 45  ✅ 真言 12  👍 认可率 78% │
└─────────────────────────────────────┘
```

---

## 七、评论系统增强

### 7.1 评论类型

| 类型 | 标识 | 说明 |
|------|------|------|
| 普通评论 | 无 | 标准文字评论 |
| 补充事实 | [补充信息] | 引导按时间/地点/事件描述 |

### 7.2 补充事实评论

针对真言帖，提供"补充事实"选项：

```
┌────────────────────────────────────────────────────┐
│  💬 写评论                                         │
│                                                    │
│  ○ 普通评论                                        │
│  ● 补充事实 - 分享你的相关经历                      │
│                                                    │
│  ────────────────────────────────────────────────  │
│                                                    │
│  我的经历时间: [选择日期]                           │
│  发生了什么:                                       │
│  ┌────────────────────────────────────────────┐   │
│  │                                            │   │
│  │                                            │   │
│  └────────────────────────────────────────────┘   │
│                                                    │
│                              [发布补充信息]        │
└────────────────────────────────────────────────────┘
```

---

## 八、从真言到供应商的孵化路径

### 8.1 孵化条件

```typescript
interface ProviderQualification {
  // 必须条件
  minFactPosts: 3;           // 某服务类型下≥3条真言
  minVotesPerPost: 5;        // 每条≥5票
  minAgreeRate: 0.70;        // 认可比例≥70%
  minUserLevel: 3;           // 用户等级≥3
  noViolations: true;        // 无违规记录
  accountAge: 30;            // 账号≥30天
}
```

### 8.2 孵化流程

```
用户发布真言（分享服务经历）
        ↓
获得邻居投票认可
        ↓
达成条件（≥3条，每条≥5票，认可率≥70%）
        ↓
系统弹出提示：
"你的真言在【XX服务】方面获得邻居高度认可，
 要不要升级为 JUSTWEDO 邻里帮手？"
        ↓
填写服务信息（范围、价格、时间）
        ↓
通过审核
        ↓
成为渥帮注册供应商
```

---

## 九、数据结构更新

### 9.1 CommunityPost 扩展

```typescript
interface CommunityPost {
  // 现有字段...

  // 新增：真言相关
  isFact: boolean;                    // 是否为真言帖
  factData?: {
    occurredAt: string;
    location: string;
    factType: FactType;
    subject?: {
      type: string;
      name: string;
      identifier?: string;
    };
    evidence?: string[];
  };

  // 新增：共识数据
  consensus?: {
    agree: number;
    partial: number;
    disagree: number;
    uncertain: number;
    level: ConsensusLevel;
  };
}
```

### 9.2 用户档案扩展

```typescript
interface UserProfile {
  // 现有字段...

  // 新增：贡献度与等级
  contribution: {
    score: number;
    level: number;
    factPosts: number;
    avgAgreeRate: number;
  };

  // 新增：徽章
  badges: string[];
}
```

### 9.3 数据库迁移

```sql
-- community_posts 表扩展
ALTER TABLE community_posts ADD COLUMN is_fact BOOLEAN DEFAULT FALSE;
ALTER TABLE community_posts ADD COLUMN fact_data JSONB;
ALTER TABLE community_posts ADD COLUMN consensus JSONB
  DEFAULT '{"agree":0,"partial":0,"disagree":0,"uncertain":0}';

-- 共识投票表
CREATE TABLE fact_votes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID REFERENCES community_posts(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  vote_type VARCHAR(20) NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(post_id, user_id)
);

-- 用户贡献度表
CREATE TABLE user_contributions (
  user_id UUID PRIMARY KEY REFERENCES users(id),
  score INTEGER DEFAULT 0,
  level INTEGER DEFAULT 1,
  fact_posts INTEGER DEFAULT 0,
  avg_agree_rate DECIMAL(3,2) DEFAULT 0,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 十、实施路线图

### Phase 1: 基础真言功能（2周）

- [ ] 更新 `community.ts` 类型定义
- [ ] 更新 `LitePost.tsx` 支持真言模式开关
- [ ] 添加真言额外字段表单
- [ ] 更新 `CommunityCardV2.tsx` 真言卡片样式
- [ ] 数据库迁移脚本

### Phase 2: 共识投票系统（2周）

- [ ] 创建 `ConsensusBar.tsx` 组件
- [ ] 创建 `FactVoteButtons.tsx` 组件
- [ ] 实现投票 API
- [ ] 共识等级计算逻辑
- [ ] 帖子详情页集成

### Phase 3: 用户等级系统（1周）

- [ ] 贡献度计算服务
- [ ] 用户等级显示组件
- [ ] 个人主页贡献度展示
- [ ] 等级权益实现

### Phase 4: 供应商孵化（1周）

- [ ] 孵化条件检测
- [ ] 孵化邀请弹窗
- [ ] 申请流程对接渥帮

---

## 十一、成功指标

### 核心指标（前3个月）

| 指标 | 目标 | 说明 |
|------|------|------|
| 真言帖占比 | 20%+ | 真言帖/总帖子 |
| 投票参与率 | 15%+ | 投票用户/浏览用户 |
| 高共识真言占比 | 60%+ | agree>=70%的真言比例 |
| Lv.3+用户占比 | 10%+ | 活跃核心用户 |
| 供应商孵化转化 | 5人/月 | 从真言孵化的供应商 |

---

## 附录：品牌命名

| 产品 | 中文 | 英文 | Slogan |
|------|------|------|--------|
| 平台 | 渥帮 | JUSTWEDO | Make Life Easier |
| 社区 | 渥说/真言 | JustTalk | 邻里事，随心说 |
| 达人 | 达人 | JustPro | 社区认可的服务者 |
