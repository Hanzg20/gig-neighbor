# HangHand (恒帮) 项目分析报告

## 📋 项目概览

**项目名称**: HangHand (恒帮) / Gig Neighbor  
**项目类型**: 社区零工经济平台  
**目标市场**: 加拿大（主要试点：渥太华 Kanata Lakes 和 Lees Ave）  
**技术栈**: React 18 + TypeScript + Vite + Supabase + Tailwind CSS  
**项目状态**: MVP 阶段，正在开发中

---

## 🎯 项目定位与价值主张

### 核心定位
HangHand 是一个**社区驱动的零工经济平台**，结合了：
- **TaskRabbit** 的专业服务匹配
- **美团** 的本地生活便利性
- **Yelp** 的信任评价体系
- **闲鱼** 的邻里好物分享

### 差异化优势
1. **加拿大本地化**: 支持季节性服务（铲雪、草坪护理）、省级许可证验证（ECRA、TSSA、RMT）
2. **邻里信任**: 通过实名认证、背景检查、保险验证建立信任
3. **多语言支持**: 架构上支持中英双语，服务于多元文化社区
4. **超本地化**: 专注于 5km 范围内的邻里服务

---

## 🏗️ 技术架构

### 前端架构
```
技术栈:
├── React 18.3.1 (UI框架)
├── TypeScript 5.8.3 (类型安全)
├── Vite 7.3.0 (构建工具)
├── React Router 6.30.1 (路由)
├── Zustand 5.0.9 (状态管理)
├── TanStack Query 5.83.0 (数据获取)
├── Tailwind CSS 3.4.17 (样式)
└── shadcn/ui (UI组件库，基于 Radix UI)
```

### 后端架构
```
基础设施:
├── Supabase (BaaS平台)
│   ├── PostgreSQL (数据库)
│   ├── PostGIS (地理空间查询)
│   ├── pgvector (AI向量搜索)
│   ├── Auth (身份认证)
│   └── Storage (文件存储)
├── Edge Functions (Supabase Functions)
└── RLS (Row Level Security) 行级安全策略
```

### 核心设计模式

#### 1. Repository Pattern (仓库模式)
**目的**: 解耦 UI 层与数据层，支持 Mock/Production 无缝切换

```typescript
// 接口定义
interface IListingRepository {
  getAll(): Promise<ListingMaster[]>;
  getById(id: string): Promise<ListingMaster | null>;
  create(listing: ListingMaster): Promise<ListingMaster>;
}

// 实现
- MockListingRepository (开发测试)
- SupabaseListingRepository (生产环境)
```

**优势**:
- 易于 A/B 测试
- 支持后端迁移（Supabase → 自建）
- 清晰的关注点分离

#### 2. Master-Detail Listing Model (主从发布模型)
**目的**: 支持复杂服务规格（如：同一保洁服务有 2小时、4小时不同套餐）

```
ListingMaster (主项)
├── 标题、描述、图片
├── 服务商信息
├── 位置、分类
└── 关联多个 ListingItem

ListingItem (规格/SKU)
├── 具体套餐名称
├── 定价信息 (金额、单位、押金)
├── 状态 (可用/缺货)
└── 属性 (JSONB)
```

**应用场景**:
- 服务类: "基础清洁 2小时" / "深度清洁 4小时"
- 租赁类: "日租 $30" / "周租 $180"
- 商品类: "全新" / "九成新"

---

## 📊 数据库设计

### 核心表结构

#### 1. 用户体系
```sql
user_profiles
├── id (UUID)
├── email, name, avatar
├── beans_balance (金豆余额)
├── roles (角色: BUYER/PROVIDER/ADMIN)
├── node_id (社区节点: NODE_LEES/NODE_KANATA)
└── provider_profile_id (关联服务商资料)

provider_profiles
├── user_id (关联用户)
├── business_name_zh/en (商家名称)
├── verification_level (1-5级认证)
├── insurance_info (保险信息)
├── license_info (许可证信息)
└── stats (订单数、收入、评分)
```

#### 2. 发布系统
```sql
listing_masters (主项)
├── id, provider_id
├── title_zh/en, description_zh/en
├── type (SERVICE/RENTAL/GOODS/TASK/CONSULTATION)
├── category_id (关联 ref_codes)
├── node_id (社区节点)
├── location (PostGIS 地理坐标)
└── status (DRAFT/PUBLISHED/ARCHIVED)

listing_items (规格)
├── id, master_id
├── name_zh/en, description_zh/en
├── pricing (JSONB: model, price, deposit)
├── status (AVAILABLE/UNAVAILABLE)
└── attributes (JSONB: 行业特定属性)
```

#### 3. 订单系统
```sql
orders
├── id, listing_id, provider_id, user_id
├── type, status (状态机)
├── amount_total, amount_deposit
├── snapshot (订单快照，防止价格变更)
├── scheduled_start/end (预约时间)
└── rental_info (租赁特定字段)

order_status_history (状态历史)
└── 记录订单状态变更轨迹
```

#### 4. 参考码系统 (Ref-Code System)
```sql
ref_codes (类目驱动表)
├── code_id (如: '1010100')
├── parent_id (支持无限级分类)
├── type (INDUSTRY/CATEGORY/STATUS/COMMUNITY_NODE)
├── zh_name, en_name
└── extra_data (JSONB: 图标、颜色、元数据)
```

**优势**: 平台类目、状态机全部通过配置表驱动，无需硬编码

---

## 🔄 业务流程

### 1. 交易模型 (Transactional Models)

#### Model 1: Instant Pay (即时支付)
**适用**: 家政服务、个人服务、邻里好物
```
流程: 选择服务 → 支付全款 → 平台托管 → 服务完成 → 48h自动释放
```

#### Model 2: Quote & Call (报价上门)
**适用**: 专业技工（电工、水管工）
```
流程: 支付上门费($50) → 师傅上门 → 提供报价 → 用户接受 → 支付尾款 → 开始工作
```

#### Model 3: Deposit & Hold (押金托管)
**适用**: 工具租赁、体育器材
```
流程: 支付租金+押金 → 押金冻结(不扣款) → 归还 → 检查 → 释放/扣除押金
```

#### Model 4: Seasonal/Subscription (季节性订阅)
**适用**: 铲雪服务、草坪护理
```
流程: 签约季节性合同 → 按月/按次支付 → 按完成情况释放
```

#### Model 5: Face-to-Face (面对面交易)
**适用**: 邻里好物、二手物品
```
流程: 预约 → 标记"已预留" → 线下见面 → 现金/转账 → 双方确认完成
```

#### Model 6: Deposit-Only (定金模式)
**适用**: 大型项目、定制服务
```
流程: 支付定金(20%) → 锁定档期 → 服务交付 → 支付尾款(80%)
```

### 2. 订单状态机

```
PENDING_PAYMENT (待支付)
    ↓
PENDING_CONFIRMATION (待确认 - 服务商接受)
    ↓
IN_PROGRESS (进行中)
    ↓
COMPLETED (已完成 - 48h自动释放)
    ↓
CANCELLED (已取消) / DISPUTED (争议中)
```

### 3. 信任与认证体系

```
Level 1: Email Verified (邮箱验证)
    ↓
Level 2: Phone Verified (手机验证)
    ↓
Level 3: Background Checked (背景检查 - CPIC)
    ↓
Level 4: Insured (保险验证 - $2M责任险)
    ↓
Level 5: Licensed (许可证验证 - ECRA/TSSA/RMT)
```

---

## 🎨 UI/UX 设计理念

### 设计哲学: "Neighborly Warmth" (邻里温暖)

**核心原则**:
1. **软几何**: 圆角卡片 (12-24px)，避免生硬边框
2. **人性化图像**: 使用真实社区场景照片，避免生硬图标
3. **信息密度**: 借鉴美团风格，高信息密度布局
4. **信任层**: 每个列表卡片显示认证徽章、社区节点、评分

### 页面结构

```
主要页面:
├── / (首页 - 发现广场)
│   ├── Hero Section (分类金刚区)
│   ├── 今日故事 (Neighbor Stories)
│   └── 动态推荐流
│
├── /service/:id (服务详情)
│   ├── 图片轮播
│   ├── 规格选择区 (ListingItems)
│   ├── 服务商信息
│   └── 评价与故事
│
├── /post-gig (发布向导)
│   ├── Step 1: 行业选择
│   ├── Step 2: 主体信息
│   ├── Step 3: 规格定价
│   └── Step 4: 标签与状态
│
├── /orders (订单中心)
│   ├── 买家视图: 服务进度条
│   └── 服务商视图: 订单管理
│
├── /chat (消息中心)
│   ├── 会话列表
│   └── 聊天窗口 (关联订单)
│
└── /profile (个人中心)
    ├── 买家模式: 收藏、订单、地址
    └── 服务商模式: 发布管理、收益统计
```

---

## 💰 金豆系统 (JinBean Points)

### 获取金豆
- 每日登录: 5 金豆 (7天连续: 10 金豆)
- 邻里担保: 20 金豆
- 写故事评价: 50 金豆
- 首次发布: 100 金豆
- 交易奖励: 每消费 $1 = 1 金豆 (上限 500)

### 消耗金豆
- 推广曝光: 200 金豆 (置顶 24h)
- 虚拟咖啡: 50 金豆 (感谢邻居)
- 手续费抵扣: 1000 金豆 = $5 手续费减免

---

## 🔐 安全与合规

### 加拿大法规合规

| 服务类型 | 法规要求 | 验证方式 |
|---------|---------|---------|
| 电工 | ECRA 许可证 | 自动查询 ESA 数据库 |
| 燃气安装 | TSSA 认证 | API 集成 |
| 按摩治疗 | RMT 注册 | CMTO 查询 |
| 食品处理 | 健康许可 | 人工审核 |

### 平台责任
- 许可证过期前 30 天提醒
- 过期许可证自动暂停发布
- 强制显示保险信息 ($2M 责任险)
- 背景检查 (CPIC) 用于入户服务

---

## 📱 跨平台策略

### Phase 1: PWA (渐进式 Web 应用)
- 当前 Vite/React 站点转换为 PWA
- 支持"添加到主屏幕"
- 基础离线缓存

### Phase 2: 微信小程序
- 使用 Taro 或 uni-app
- 复用 70% 业务逻辑
- 连接同一 Supabase 后端

### Phase 3: 原生 App
- React Native (Expo)
- 复用 80% 业务逻辑
- 支持推送通知、生物识别登录

---

## 🤖 AI 辅助层

### MVP 功能
1. **智能价格指导**: 分析历史数据，建议"公平邻里价格"
2. **语义搜索**: 使用向量嵌入匹配相关服务
3. **内容审核**: 实时筛查违规内容

### 未来规划
- 自然语言发布: "我需要明天下午2点有人帮我搬IKEA沙发"
- 实时双语翻译: 中英文消息自动翻译
- 图像智能: 自动分类和评估上传照片

---

## 📈 项目状态

### 已完成 ✅
- [x] Supabase 客户端集成
- [x] 认证系统 (Auth + User Profiles)
- [x] Repository Pattern 实现
- [x] 基础 UI 组件 (shadcn/ui)
- [x] 订单状态机
- [x] 购物车系统
- [x] 消息系统基础架构

### 进行中 🚧
- [ ] 完整 Supabase Schema 部署
- [ ] 种子数据导入
- [ ] 剩余 Repository 实现
- [ ] 支付集成 (Stripe)

### 待开发 📋
- [ ] 许可证验证 API (ECRA, TSSA)
- [ ] 背景检查集成 (CPIC)
- [ ] AI 向量搜索
- [ ] 推送通知
- [ ] 多语言切换 (i18n)

---

## 🗂️ 项目结构

```
gig-neighbor/
├── src/
│   ├── components/        # UI 组件
│   │   ├── ui/           # shadcn/ui 基础组件
│   │   ├── Post/         # 发布相关组件
│   │   ├── Detail/       # 详情页组件
│   │   └── flows/        # 业务流程组件
│   │
│   ├── pages/            # 页面组件
│   │   ├── Index.tsx     # 首页
│   │   ├── ServiceDetail.tsx
│   │   ├── PostGig.tsx
│   │   ├── Orders.tsx
│   │   └── Chat.tsx
│   │
│   ├── services/         # 业务逻辑层
│   │   └── repositories/ # 数据访问层
│   │       ├── interfaces.ts
│   │       ├── factory.ts
│   │       └── supabase/ # Supabase 实现
│   │
│   ├── stores/           # Zustand 状态管理
│   │   ├── authStore.ts
│   │   ├── listingStore.ts
│   │   ├── orderStore.ts
│   │   └── cartStore.ts
│   │
│   ├── types/            # TypeScript 类型定义
│   │   ├── domain.ts     # 领域模型
│   │   └── orders.ts
│   │
│   ├── hooks/            # 自定义 Hooks
│   ├── lib/              # 工具库
│   │   ├── supabase.ts
│   │   └── utils.ts
│   │
│   └── context/          # React Context
│
├── docs/                 # 文档
│   ├── product_requirements_document.md
│   ├── system_design_document.md
│   ├── supabase_schema.sql
│   ├── seed_data.sql
│   └── QUICK_START.md
│
├── supabase/
│   └── functions/        # Edge Functions
│       └── generate-embedding/
│
└── public/               # 静态资源
```

---

## 🔍 代码质量分析

### 优势
1. **类型安全**: 全面使用 TypeScript，定义清晰的领域模型
2. **架构清晰**: Repository Pattern 实现良好的关注点分离
3. **可扩展性**: 支持 Mock/Production 切换，易于测试
4. **文档完善**: 详细的产品需求文档和系统设计文档

### 改进建议
1. **测试覆盖**: 目前缺少单元测试和集成测试
2. **错误处理**: 需要统一的错误处理机制
3. **性能优化**: 考虑添加 React.memo、useMemo 优化
4. **国际化**: i18n 基础设施已准备，但 UI 尚未实现多语言切换

---

## 🎯 关键指标 (KPI)

### 用户获取
- CAC (客户获取成本)
- 服务商激活率
- 地理密度 (每平方公里服务数)

### 交易指标
- GMV (总交易额)
- 平台抽成率 (5%)
- 订单完成率
- 押金没收率 (租赁)

### 信任指标
- 背景检查通过率
- 许可证验证周转时间
- 争议解决时间

### 季节性指标
- 铲雪预订量 (11月-3月)
- 草坪护理预订量 (4月-10月)

---

## 🚀 部署与运维

### 环境配置
```bash
# .env.local
VITE_SUPABASE_URL=https://xxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGci...
VITE_USE_MOCK_DATA=false
VITE_DEFAULT_NODE=NODE_LEES
```

### 构建命令
```bash
npm run dev          # 开发服务器
npm run build        # 生产构建
npm run build:dev    # 开发模式构建
npm run preview      # 预览构建结果
```

### 数据库迁移
1. 执行 `docs/supabase_schema.sql` 创建表结构
2. 执行 `docs/supabase_triggers.sql` 创建触发器
3. 执行 `docs/seed_data.sql` 导入种子数据

---

## 📝 总结

HangHand 是一个**架构清晰、设计完善**的社区零工经济平台项目。项目采用了现代化的技术栈和设计模式，具有良好的可扩展性和可维护性。

**核心亮点**:
- ✅ 清晰的领域模型设计 (Master-Detail Listing)
- ✅ 灵活的 Repository Pattern 架构
- ✅ 完善的文档体系
- ✅ 加拿大本地化合规设计

**下一步建议**:
1. 完成 Supabase Schema 完整部署
2. 实现支付集成 (Stripe)
3. 添加单元测试和集成测试
4. 优化移动端响应式设计
5. 实现 AI 向量搜索功能

---

**报告生成时间**: 2026-01-XX  
**项目版本**: v0.0.1 (MVP)
